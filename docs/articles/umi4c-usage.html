<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>umi4cPackage â€¢ umi4cPackage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="umi4cPackage">
<meta property="og:description" content="umi4cPackage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">umi4cPackage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/umi4c-usage.html">
    <span class="fas fa-road"></span>
     
    Usage
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-th-list"></span>
     
    Reference
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>umi4cPackage</h1>
                        <h4 class="author">Omer Schwartzman</h4>
            
            <h4 class="date">2021-06-16</h4>
      
      
      <div class="hidden name"><code>umi4c-usage.Rmd</code></div>

    </div>

    
    
<p>UMI-4C Package is a processing and analysis pipeline for UMI-4C experiments.</p>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>This package is intended for processing and analysis of UMI-4C experiments. The UMI-4C protocol exploits sonication of 3C template material to facilitate molecule counting and quantitative analysis of chromatin contacts of one or several genomic loci at high resolution.</p>
<p>The two parts of the package are:</p>
<ul>
<li>
<strong>Processing of of raw reads (FASTQ format) to genomic tracks:</strong> <strong>Paired-end</strong> FASTQ files are parsed, splitted according to the restriction enzyme sequence (Usually DpnII) and summarized in adjacency table (<em>adj</em> file). This part uses as a bunch of <em>Perl</em> scripts wrapped in R.</li>
<li>
<strong>Analyzing UMI-4C genomic tracks and producing nearcis figures:</strong> Genomic tracks are dynamically processed to produce nearcis profiles at the desired genomic region specified by the user.</li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div id="requirements" class="section level3">
<h3 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements:</h3>
<p>The pipeline is designed to run on a standard linux machine. The basic requirements are:</p>
<ul>
<li><em>Perl</em></li>
<li>
<em>Bowtie2</em>: <a href="http://bowtie-bio.sourceforge.net/bowtie2" class="uri">http://bowtie-bio.sourceforge.net/bowtie2</a>
</li>
<li>Reference index for <em>Bowtie2</em>
</li>
<li>R packages:
<ul>
<li><em>devtools</em></li>
<li><em>misha</em></li>
<li><em>zoo</em></li>
</ul>
</li>
</ul>
<div id="installation-1" class="section level4">
<h4 class="hasAnchor">
<a href="#installation-1" class="anchor"></a>Installation</h4>
<p>Install the r dependencies:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install devtools if not installed</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Install misha if not installed</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">misha</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'misha'</span>, repos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">'repos'</span><span class="op">)</span>,       <span class="st">'https://tanaylab.github.io/repo'</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Download and install <em>umi4cPackage</em>:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"tanaylab/umi4cpackage"</span>, vignette <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">umi4cPackage</span><span class="op">)</span></code></pre></div>
<div id="preparing-genomic-database" class="section level5">
<h5 class="hasAnchor">
<a href="#preparing-genomic-database" class="anchor"></a>Preparing genomic database</h5>
<p>The pipeline requires a special database called <em>trackdb</em> which contains binary genomic tracks and other data, as well as restriction site database in text format called <em>redb</em>.</p>
<p>Downloading the data (~2.5Gb) is done from inside the package.<br>
We will first create a new project directory:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">mkdir</span> my_u4c_proj</code></pre></div>
<p>From <em>R</em> we will download the data to the provided folder:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"umi4cPackage"</span><span class="op">)</span>
<span class="co"># Use build 'hg19' for DpnII enzyme</span>
<span class="fu"><a href="../reference/p4cBuildRequirements.html">p4cBuildRequirements</a></span><span class="op">(</span>output_dir <span class="op">=</span> <span class="st">"my_u4c_proj"</span>, genome <span class="op">=</span> <span class="st">"hg19"</span>, reseq <span class="op">=</span> <span class="st">"GATC"</span><span class="op">)</span></code></pre></div>
<p>Two directory will be generated after downloading the extracting the data:</p>
<ul>
<li>
<strong>my_u4c_proj/hg19/trackdb</strong><br>
</li>
<li><strong>my_u4c_proj/hg19/redb</strong></li>
</ul>
<hr>
</div>
</div>
</div>
<div id="configuration-files" class="section level3">
<h3 class="hasAnchor">
<a href="#configuration-files" class="anchor"></a>Configuration files</h3>
<p>The next step is to set up the <em>conf</em> files. To do so we will first need to dump templates of conf files to a conf directory:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/p4cDumpConfFiles.html">p4cDumpConfFiles</a></span><span class="op">(</span>conf_dir <span class="op">=</span> <span class="st">"my_u4c_proj/conf"</span><span class="op">)</span></code></pre></div>
<p>Now we will need to go to the supplied directory (<code>my_u4c_proj/conf</code> in our case) and complete the <em>conf</em> files.<br><strong>Make sure that all newlines are linux compatible (\n) and not windows (\r\n)!</strong></p>
<ul>
<li>
<strong>paths.conf</strong>: Set the paths to the directories and dependencies.<br>
</li>
<li>
<strong>samples.txt</strong>: Samples table, tab separated. One row for each experiment. Mandatory columns are:
<ul>
<li>
<strong>Sample_ID</strong>: Unique ID.</li>
<li>
<strong>Sample_name</strong>: Unique sample name. e.g., Cell type, condition etc...</li>
<li>
<strong>Experiment_name</strong>: A shared name for the experiment batch.<br>
</li>
<li>
<strong>fastqs_regex</strong>: Regular expression that captures all FASTQ files names associated with the sample. <strong>Important: the files should have the suffix *.fastq . The FASTQ filenames must also contain 'R1' and 'R2' which associate the file with the paired-end sequencing direction</strong>.</li>
<li>
<strong>fastqs_dir</strong>: Path to FASTQ directory.</li>
<li>
<strong>Bait_IDs</strong>: Unique IDs of baits associated with the experiment. A comma separated list of bait IDs from baits.txt.</li>
</ul>
</li>
<li>
<strong>baits.txt</strong>: Baits table, tab separated. One row for each bait. Mandatory columns are:
<ul>
<li>
<strong>Bait_ID</strong>: Unique bait ID - associates sample to bait.</li>
<li>
<strong>Bait_name</strong>: Unique bait name.</li>
<li>
<strong>Bait_seq</strong>: Sequence of the (DS) bait primer without the padding sequence. It accepts also regular expressions (e.g., AGGCA.+GGG).</li>
<li>
<strong>Bait_pad</strong>: Padding sequence - the sequence between the bait primer end to the bait fragment restriction site (including the restriction sequence, e.g., for DpnII: XXXXGATC).</li>
<li>
<strong>Bait_chr</strong>: Bait chromosome.</li>
<li>
<strong>Bait_coord</strong>: Bait coord. Ideally the coordinate of the nearest restriction site to the bait.</li>
</ul>
</li>
<li>
<strong>pipeline.conf</strong>: Pipeline settings. The defaults should work fine for <strong>DpnII</strong>.<br>
</li>
<li>
<strong>p4c.conf</strong>: Analysis settings. The defaults should work fine.</li>
</ul>
<hr>
</div>
</div>
<div id="importing-and-analyzing-umi-4c-files-" class="section level2">
<h2 class="hasAnchor">
<a href="#importing-and-analyzing-umi-4c-files-" class="anchor"></a>Importing and analyzing UMI-4C files.</h2>
<div id="initialization" class="section level3">
<h3 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization:</h3>
<p>We need to load the configuration files to our envirnoment by:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/p4cLoadConfFiles.html">p4cLoadConfFiles</a></span><span class="op">(</span>conf_dir <span class="op">=</span> <span class="st">"my_u4c_proj/conf"</span><span class="op">)</span></code></pre></div>
<div id="working-example" class="section level4">
<h4 class="hasAnchor">
<a href="#working-example" class="anchor"></a>Working example:</h4>
<p>Download example fastqs from: <a href="http://compgenomics.weizmann.ac.il/tanay/?page_id=617" class="uri">http://compgenomics.weizmann.ac.il/tanay/?page_id=617</a>. These files include three UMI-4C experiments done on three cell lines on the <em>ANK1</em> promoter.<br>
Extract the files to a directory.<br>
In <strong>samples.txt</strong> - change <em>fastqs_dir</em> to the working directory with the downloaded example files. Notice that the pipeline detect the files associated files by the regular expression pattern defined in <em>fastqs_regex</em>. See that <em>Bait_IDs</em> of the samples is 1.<br>
In <strong>baits.txt</strong> - Inspect that indeed the <em>Bait_ID</em> 1 is correctly filled.</p>
<div id="importing-genomic-tracks" class="section level5">
<h5 class="hasAnchor">
<a href="#importing-genomic-tracks" class="anchor"></a>Importing genomic tracks</h5>
<p>Now we will run the pipeline on a single sample:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/p4cCreate4CseqTrack.html">p4cCreate4CseqTrack</a></span><span class="op">(</span>sample_ids <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>All intermediate files will be saved in the workdir that was defined in <em>TG3C.workdir</em> parameter.</p>
<p>The pipeline uses the samples and baits tables to retrieve the relevant information on experiment ID#1, and transform the raw fastq files to UMI counts (see more details on intermediate steps below). This might take some time, depending on the size of the fastq file and the machine being used. Then UMI counts are imported and saved in a special data structure we refer to as "genomic tracks". For each sample-bait combination a genomic track will generated. In our example, a track named <code>umi4C_example_CMK_ANK1_TSS</code> will be generated. This track contains data for sample CMK and bait <em>ANK1_TSS</em>.<br>
After successfully importing the data, the pipeline will report some essential statistics.<br>
These statistics can also be accessed from 4CQC.txt in the sample workdir directory.</p>
<p>Once imported the genomic tracks are saved in our trackdb, and can be listed by:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/misha/man/gtrack.ls.html">gtrack.ls</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="analyzing-and-plotting" class="section level4">
<h4 class="hasAnchor">
<a href="#analyzing-and-plotting" class="anchor"></a>Analyzing and plotting</h4>
<p>Now we can analyze the data:<br>
Suppose we want to create an UMI-4C profile 200kb upstream and downstream the bait in our exmaple CMK experiment. The first step is to create <code>p4cProfile object</code>:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CMK_fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p4cNewProfile.html">p4cNewProfile</a></span><span class="op">(</span><span class="st">"umi4C_example_CMK_ANK1_TSS"</span>, scope_5<span class="op">=</span><span class="fl">200000</span>, scope_3<span class="op">=</span><span class="fl">200000</span><span class="op">)</span></code></pre></div>
<p>Plot nearcis profile:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">CMK_fc</span><span class="op">)</span></code></pre></div>
<p>This command generates a plot of the 4C profile with a smoothed trend and a domainogram. It accepts some more parameters which are described in the function documentation: <code><a href="../reference/plot.p4cProfile.html">?plot.p4cProfile</a></code>.<br>
For example, if we want to save the domainogram to a png file we can do:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">CMK_fc</span>, png_fn<span class="op">=</span><span class="st">"figs/CMK_ANK1_TSS.png"</span><span class="op">)</span></code></pre></div>
</div>
<div id="compare-the-profile-to-another-profile" class="section level4">
<h4 class="hasAnchor">
<a href="#compare-the-profile-to-another-profile" class="anchor"></a>Compare the profile to another profile</h4>
<p>To compare two 4C experiments, we first import two other profiles (notice, this time we will do it in batch):</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/p4cCreate4CseqTrack.html">p4cCreate4CseqTrack</a></span><span class="op">(</span>sample_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Two new tracks were created. To list the tracks again by <code><a href="https://rdrr.io/pkg/misha/man/gtrack.ls.html">gtrack.ls()</a></code>.</p>
<p>After the tracks were imported we can produce comparative plots. For example, we will compare CMK which express <em>ANK1</em> gene to <em>DND41</em> which does not.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate a second p4cProfile on the same scope</span>
<span class="va">DND41_fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p4cNewProfile.html">p4cNewProfile</a></span><span class="op">(</span><span class="st">"umi4C_example_DND41_ANK1_TSS"</span>, scope_5<span class="op">=</span><span class="fl">200000</span>, scope_3<span class="op">=</span><span class="fl">200000</span><span class="op">)</span>

<span class="co"># plot a comparative plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">CMK_fc</span>, <span class="va">DND41_fc</span><span class="op">)</span></code></pre></div>
<p>Additional feature is the ability to derive mean contact intensity for defined genomic intervals. The following command will return normalized contact intensities of the two profiles, fold change, and p-value (Chi-square test)</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fold_change</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p4cIntervalsMean.html">p4cIntervalsMean</a></span><span class="op">(</span><span class="va">CMK_fc</span>, <span class="va">DND41_fc</span>, start<span class="op">=</span><span class="fl">41665000</span>, end<span class="op">=</span><span class="fl">41675000</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">fold_change</span>, align <span class="op">=</span> <span class="st">'l'</span>, digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amos Tanay, Omer Schwartzman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
