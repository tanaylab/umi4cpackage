<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Background</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<p>UMI-4C Package is a processing and analysis pipeline for UMI-4C experiments. </p>

<h2>Background</h2>

<p>This package is intended for processing and analysis of UMI-4C experiments. The UMI-4C protocol exploits 
sonication of 3C template material to facilitate molecule counting and quantitative analysis of chromatin contacts of one or several genomic loci at high resolution.  </p>

<p>The two parts of the package are:  </p>

<ul>
<li><strong>Processing of of raw reads (FASTQ format) to genomic tracks:</strong>
<strong>Paired-end</strong> FASTQ files are parsed, splitted according to the restriction enzyme sequence (Usually DpnII) 
and summarized in adjacency table (<em>adj</em> file). This part uses as a bunch of <em>Perl</em> scripts wrapped in R.</li>
<li><strong>Analyzing UMI-4C genomic tracks and producing nearcis figures:</strong>
Genomic tracks are dynamically processed to produce nearcis profiles at the desired genomic region specified by the user.</li>
</ul>

<h2>Installation</h2>

<h3>Requirements:</h3>

<p>The pipeline is designed to run on a standard linux machine. The basic requirements are: </p>

<ul>
<li><em>Perl</em></li>
<li><em>Bowtie2</em>: <a href="http://bowtie-bio.sourceforge.net/bowtie2">http://bowtie-bio.sourceforge.net/bowtie2</a></li>
<li>Reference index for <em>Bowtie2</em></li>
<li>R packages:

<ul>
<li><em>devtools</em></li>
<li><em>misha</em></li>
<li><em>zoo</em></li>
</ul></li>
</ul>

<h4>Installing misha package:</h4>

<p>Since <em>misha</em> package is not in CRAN, we will need to install it directly as follow:<br/>
Download the package from: <a href="http://compgenomics.weizmann.ac.il/tanay/?page_id=617">http://compgenomics.weizmann.ac.il/tanay/?page_id=617</a>.<br/>
Install the package:</p>

<pre><code class="r">install.packages(&quot;misha_3.2.7.tar.gz&quot;, repos=NULL) #Installs misha package from file
</code></pre>

<h4>Importing UMI-4C package:</h4>

<p>Download and install <em>umi4cPackage</em>: </p>

<pre><code class="r">devtools::install_bitbucket(&quot;tanaylab/umi4cpackage&quot;, ref=&#39;default&#39;)
library(umi4cPackage)
</code></pre>

<p>Alternatively, install the package directly from the source:</p>

<pre><code class="r">install.packages(&quot;umi4cPackage.tar.gz&quot;, repos=NULL)
</code></pre>

<h5>Preparing genomic database</h5>

<p>The pipeline requires a special database called <em>trackdb</em> which contains binary genomic tracks and other data, as well as restriction site database in text format called <em>redb</em>.  </p>

<p>Downloading the data (~2.5Gb) is done from inside the package.<br/>
We will first create a new project directory:</p>

<pre><code class="bash">mkdir my_u4c_proj

</code></pre>

<p>From <em>R</em> we will download the data to the provided folder:</p>

<pre><code class="r">library(&quot;umi4cPackage&quot;)
# Use build &#39;hg19&#39; for DpnII enzyme
p4cBuildRequirements(output_dir = &quot;my_u4c_proj&quot;, genome = &quot;hg19&quot;, reseq = &quot;GATC&quot;)
</code></pre>

<p>Two directory will be generated after downloading the extracting the data:  </p>

<ul>
<li><strong>my_u4c_proj/hg19/trackdb</strong><br/></li>
<li><strong>my_u4c_proj/hg19/redb</strong></li>
</ul>

<hr/>

<h3>Configuration files</h3>

<p>The next step is to set up the <em>conf</em> files. To do so we will first need to dump templates of conf files to a conf directory:</p>

<pre><code class="r">p4cDumpConfFiles(conf_dir = &quot;my_u4c_proj/conf&quot;)
</code></pre>

<p>Now we will need to go to the supplied directory (<code>my_u4c_proj/conf</code> in our case) and complete the <em>conf</em> files.<br/>
<strong>Make sure that all newlines are linux compatible (\n) and not windows (\r\n)!</strong>  </p>

<ul>
<li><strong>paths.conf</strong>: Set the paths to the directories and dependencies.<br/></li>
<li><strong>samples.txt</strong>: Samples table, tab separated. One row for each experiment. Mandatory columns are:<br/>

<ul>
<li><strong>Sample_ID</strong>: Unique ID. </li>
<li><strong>Sample_name</strong>: Unique sample name. e.g., Cell type, condition etc&hellip;</li>
<li><strong>Experiment_name</strong>: A shared name for the experiment batch.<br/></li>
<li><strong>fastqs_regex</strong>: Regular expression that captures all FASTQ files names associated with the sample. <strong>Important: the files should have the suffix *.fastq . The FASTQ filenames must also contain &#39;R1&#39; and &#39;R2&#39; which associate the file with the paired-end sequencing direction</strong>. </li>
<li><strong>fastqs_dir</strong>: Path to FASTQ directory.</li>
<li><strong>Bait_IDs</strong>: Unique IDs of baits associated with the experiment. A comma separated list of bait IDs from baits.txt.</li>
</ul></li>
<li><strong>baits.txt</strong>: Baits table, tab separated. One row for each bait. Mandatory columns are:<br/>

<ul>
<li><strong>Bait_ID</strong>: Unique bait ID - associates sample to bait.</li>
<li><strong>Bait_name</strong>: Unique bait name. </li>
<li><strong>Bait_seq</strong>: Sequence of the (DS) bait primer without the padding sequence. It accepts also regular expressions (e.g., AGGCA.+GGG). </li>
<li><strong>Bait_pad</strong>: Padding sequence - the sequence between the bait primer end to the bait fragment restriction site (including the restriction sequence, e.g., for DpnII: XXXXGATC).</li>
<li><strong>Bait_chr</strong>: Bait chromosome.</li>
<li><strong>Bait_coord</strong>: Bait coord. Ideally the coordinate of the nearest restriction site to the bait.</li>
</ul></li>
<li><strong>pipeline.conf</strong>: Pipeline settings. The defaults should work fine for <strong>DpnII</strong>.<br/></li>
<li><strong>p4c.conf</strong>: Analysis settings. The defaults should work fine.<br/></li>
</ul>

<hr/>

<h2>Importing and analyzing UMI-4C files.</h2>

<h3>Initialization:</h3>

<p>We need to load the configuration files to our envirnoment by:</p>

<pre><code class="r">p4cLoadConfFiles(conf_dir = &quot;my_u4c_proj/conf&quot;)
</code></pre>

<h4>Working example:</h4>

<p>Download example fastqs from: <a href="http://compgenomics.weizmann.ac.il/tanay/?page_id=617">http://compgenomics.weizmann.ac.il/tanay/?page_id=617</a>. These files include three UMI-4C experiments done on three cell lines on the <em>ANK1</em> promoter.<br/>
Extract the files to a directory.<br/>
In <strong>samples.txt</strong> - change <em>fastqs_dir</em> to the working directory with the downloaded example files. Notice that the pipeline detect the files associated files by the regular expression pattern defined in <em>fastqs_regex</em>. See that <em>Bait_IDs</em> of the samples is 1.<br/>
In <strong>baits.txt</strong> - Inspect that indeed the <em>Bait_ID</em> 1 is correctly filled.  </p>

<h5>Importing genomic tracks</h5>

<p>Now we will run the pipeline on a single sample:</p>

<pre><code class="r">p4cCreate4CseqTrack(sample_ids = 1)
</code></pre>

<p>All intermediate files will be saved in the workdir that was defined in <em>TG3C.workdir</em> parameter.</p>

<p>The pipeline uses the samples and baits tables to retrieve the relevant information on experiment ID#1, and transform the raw fastq files to UMI counts (see more details on intermediate steps below). This might take some time, depending on the size of the fastq file and the machine being used. 
Then UMI counts are imported and saved in a special data structure we refer to as &ldquo;genomic tracks&rdquo;. For each sample-bait combination a genomic track will generated.
In our example, a track named <code>umi4C_example_CMK_ANK1_TSS</code> will be generated. This track contains data for sample CMK and bait <em>ANK1_TSS</em>.<br/>
After successfully importing the data, the pipeline will report some essential statistics.<br/>
These statistics can also be accessed from 4CQC.txt in the sample workdir directory.  </p>

<p>Once imported the genomic tracks are saved in our trackdb, and can be listed by:<br/>
&ldquo;r, eval=FALSE}
gtrack.ls()</p>

<pre><code>
#### Analyzing and plotting
Now we can analyze the data:  
Suppose we want to create an UMI-4C profile 200kb upstream and downstream the bait in our exmaple CMK experiment. The first step is to create `p4cProfile object`:

```r
CMK_fc &lt;- p4cNewProfile(&quot;umi4C_example_CMK_ANK1_TSS&quot;, scope_5=200000, scope_3=200000)
</code></pre>

<p>Plot nearcis profile:</p>

<pre><code class="r">plot(CMK_fc)
</code></pre>

<p>This command generates a plot of the 4C profile with a smoothed trend and a domainogram. It accepts some more parameters which are described in the function documentation: <code>?plot.p4cProfile</code>.<br/>
For example, if we want to save the domainogram to a png file we can do:</p>

<pre><code class="r">plot(CMK_fc, png_fn=&quot;figs/CMK_ANK1_TSS.png&quot;)
</code></pre>

<h4>Compare the profile to another profile</h4>

<p>To compare two 4C experiments, we first import two other profiles (notice, this time we will do it in batch):</p>

<pre><code class="r">p4cCreate4CseqTrack(sample_ids = c(2,3))
</code></pre>

<p>Two new tracks were created. To list the tracks again by <code>gtrack.ls()</code>.</p>

<p>After the tracks were imported we can produce comparative plots. For example, we will compare CMK
which express <em>ANK1</em> gene to <em>DND41</em> which does not.</p>

<pre><code class="r"># Generate a second p4cProfile on the same scope
DND41_fc &lt;- p4cNewProfile(&quot;umi4C_example_DND41_ANK1_TSS&quot;, scope_5=200000, scope_3=200000)

# plot a comparative plot
plot(CMK_fc, DND41_fc)
</code></pre>

<p>Additional feature is the ability to derive mean contact intensity for defined genomic intervals. The following command will return normalized contact intensities of the two profiles, fold change, 
and p-value (Chi-square test)</p>

<pre><code class="r">fold_change &lt;- p4cIntervalsMean(CMK_fc, DND41_fc, start=41665000, end=41675000)
knitr::kable(fold_change, align = &#39;l&#39;, digits=2)
</code></pre>

</body>

</html>

